# VS Code Server Cleanup Script

## Overview

This script helps you clean up your Visual Studio Code (VS Code) Server installation on a remote machine. Over time, VS Code Server can accumulate multiple outdated versions of the server itself, extensions, and cached data, which can consume significant disk space. This script automates the process of removing this redundant data, keeping only the latest versions.

## Features

-   **Cleans Old Server Versions**: Automatically detects the latest VS Code Server version and removes all older ones, including their corresponding launchers and log files.
-   **Removes Outdated Extensions**: For each extension, it identifies and deletes all old versions, keeping only the most recent one.
-   **Clears Caches and Logs**: Deletes user-specific caches and logs generated by the server to free up additional space.
-   **Safe and Informative**: Provides detailed output about which files and directories are being deleted.

## Prerequisites

-   A Unix-like operating system (e.g., Linux, macOS).
-   Bash shell.
-   VS Code Server installed in the default location (`~/.vscode-server`).

## How to Use

1.  **Download the Script**

    Save the script content as `cleanup_vscode_server.sh` on your remote machine.

2.  **Make the Script Executable**

    Open your terminal and navigate to the directory where you saved the script. Run the following command to grant execute permissions:

    ```bash
    chmod +x cleanup_vscode_server.sh
    ```

3.  **Run the Script**

    Execute the script from your terminal:

    ```bash
    ./cleanup_vscode_server.sh
    ```

    The script will then scan your `~/.vscode-server` directory and perform the cleanup operations.

## How It Works

The script performs the cleanup in three main steps:

### Step 1: Clean Up Old Server Versions

The script first identifies the installation directory of VS Code Server, which is typically `~/.vscode-server`. It then:
1.  Looks into `~/.vscode-server/cli/servers` to find all installed server versions (e.g., `Stable-a1b2c3d...`).
2.  Identifies the latest version based on the directory's modification time.
3.  Deletes all older server directories.
4.  Removes corresponding old server launchers (`code-*`) and log files (`.cli.*.log`) from the `~/.vscode-server` root directory that do not match the latest version's commit hash.

### Step 2: Clean Up Old Extension Versions

Next, the script targets outdated extensions in `~/.vscode-server/extensions`. For each installed extension:
1.  It groups all installed versions of that extension (e.g., `author.extension-name-1.0.0`, `author.extension-name-1.1.0`).
2.  It sorts these versions to determine the latest one.
3.  It removes all versions except for the latest one.

### Step 3: Clean Up Cache and Logs

Finally, the script cleans up temporary data stored in `~/.vscode-server/data`. It removes the following directories to clear caches and logs:
-   `data/logs`: Contains various log files.
-   `data/CachedExtensionVSIXs`: Caches for downloaded extension packages.
-   `data/clp`: The connection-level cache for remote sessions.

## Disclaimer

This script performs destructive `rm -rf` operations. While it is designed to only target outdated VS Code Server files, it is highly recommended to **back up any important data** within the `~/.vscode-server` directory before running it for the first time. The author is not responsible for any data loss that may occur. Use this script at your own risk.
